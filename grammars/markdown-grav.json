{
  "name": "Markdown (Grav)",
  "scopeName": "text.html.markdown.grav",
  "fileTypes": ["md", "grav"],
  "patterns": [
    {
      "include": "#frontmatter"
    },
    {
      "include": "#twig"
    },
    {
      "include": "#shortcodes"
    },
    {
      "include": "text.html.markdown"
    }
  ],
  "repository": {
    "frontmatter": {
      "name": "meta.frontmatter.yaml.grav",
      "begin": "\\A---\\s*$",
      "end": "^---\\s*$",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.begin.grav" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.end.grav" }
      },
      "patterns": [
        {
          "include": "source.yaml"
        }
      ]
    },
    "twig": {
      "patterns": [
        {
          "include": "#twig-comment"
        },
        {
          "include": "#twig-output"
        },
        {
          "include": "#twig-statement"
        }
      ]
    },
    "twig-comment": {
      "name": "comment.block.twig.grav",
      "begin": "\\{#",
      "end": "#\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.comment.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.comment.end.twig" }
      }
    },
    "twig-output": {
      "name": "meta.output.twig.grav",
      "begin": "\\{\\{-?",
      "end": "-?\\}\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.output.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.output.end.twig" }
      },
      "patterns": [
        {
          "include": "#twig-expression"
        }
      ]
    },
    "twig-statement": {
      "name": "meta.statement.twig.grav",
      "begin": "\\{%-?",
      "end": "-?%\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.statement.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.statement.end.twig" }
      },
      "patterns": [
        {
          "include": "#twig-keywords"
        },
        {
          "include": "#twig-expression"
        }
      ]
    },
    "twig-keywords": {
      "match": "\\b(if|else|elseif|endif|for|endfor|in|block|endblock|extends|include|embed|endembed|macro|endmacro|import|from|as|set|endset|with|endwith|autoescape|endautoescape|filter|endfilter|spaceless|endspaceless|verbatim|endverbatim|apply|endapply|do|flush|use|only|ignore missing|sandbox|endsandbox|trans|endtrans|transchoice|cache|endcache)\\b",
      "name": "keyword.control.twig"
    },
    "twig-expression": {
      "patterns": [
        {
          "name": "string.quoted.single.twig",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" }
          ]
        },
        {
          "name": "string.quoted.double.twig",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" },
            { "include": "#twig-interpolation" }
          ]
        },
        {
          "name": "constant.numeric.twig",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        },
        {
          "name": "constant.language.twig",
          "match": "\\b(true|false|null|none)\\b"
        },
        {
          "name": "keyword.operator.twig",
          "match": "\\b(and|or|not|in|is|as)\\b|==|!=|<|>|<=|>=|\\+|-|\\*|/|%|\\||~|\\.\\.|\\.(?!\\d)|\\?"
        },
        {
          "name": "support.function.twig",
          "match": "\\b(abs|batch|capitalize|column|convert_encoding|country_name|currency_name|currency_symbol|data_uri|date|date_modify|default|e|escape|filter|first|format|format_currency|format_date|format_datetime|format_number|format_time|html_to_markdown|inky_to_html|inline_css|join|json_encode|keys|language_name|last|length|locale_name|lower|map|markdown_to_html|merge|nl2br|number_format|raw|reduce|replace|reverse|round|slice|slug|sort|spaceless|split|striptags|timezone_name|title|trim|u|upper|url_encode)\\b"
        },
        {
          "name": "variable.other.twig",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        }
      ]
    },
    "twig-interpolation": {
      "name": "meta.interpolation.twig",
      "begin": "#\\{",
      "end": "\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.interpolation.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.interpolation.end.twig" }
      },
      "patterns": [
        { "include": "#twig-expression" }
      ]
    },
    "shortcodes": {
      "patterns": [
        {
          "include": "#shortcode-self-closing"
        },
        {
          "include": "#shortcode-block"
        }
      ]
    },
    "shortcode-self-closing": {
      "name": "meta.shortcode.self-closing.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)([^\\]]*?)(/\\])",
      "captures": {
        "1": { "name": "punctuation.definition.shortcode.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "patterns": [{ "include": "#shortcode-attributes" }] },
        "4": { "name": "punctuation.definition.shortcode.end.grav" }
      }
    },
    "shortcode-block": {
      "name": "meta.shortcode.block.grav",
      "begin": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)([^\\]]*?)(\\])",
      "end": "(\\[/)\\2(\\])",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.shortcode.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "patterns": [{ "include": "#shortcode-attributes" }] },
        "4": { "name": "punctuation.definition.shortcode.end.grav" }
      },
      "endCaptures": {
        "1": { "name": "punctuation.definition.shortcode.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "punctuation.definition.shortcode.end.grav" }
      },
      "patterns": [
        { "include": "#twig" },
        { "include": "text.html.markdown" }
      ]
    },
    "shortcode-attributes": {
      "patterns": [
        {
          "name": "entity.other.attribute-name.shortcode.grav",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_-]*)\\s*(?==)"
        },
        {
          "name": "string.quoted.double.shortcode.grav",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "include": "#twig-output" }
          ]
        },
        {
          "name": "string.quoted.single.shortcode.grav",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "include": "#twig-output" }
          ]
        },
        {
          "name": "string.unquoted.shortcode.grav",
          "match": "(?<==)[^\\s\\]\"']+"
        }
      ]
    }
  }
}
