{
  "name": "Markdown (Grav)",
  "scopeName": "text.html.markdown.grav",
  "fileTypes": ["grav", "md"],
  "patterns": [
    { "include": "#frontmatter" },
    { "include": "#fenced-code-block" },
    { "include": "#twig" },
    { "include": "#shortcodes" },
    { "include": "#blockquote" },
    { "include": "#horizontal-rule" },
    { "include": "#heading" },
    { "include": "#list-item" },
    { "include": "#inline" }
  ],
  "repository": {
    "frontmatter": {
      "name": "meta.frontmatter.yaml.grav",
      "begin": "\\A---\\s*$",
      "end": "^---\\s*$",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.begin.grav" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.end.grav" }
      },
      "patterns": [
        { "include": "#yaml-content" }
      ]
    },
    "yaml-content": {
      "patterns": [
        {
          "comment": "YAML comment",
          "name": "comment.line.number-sign.yaml",
          "match": "^\\s*#.*$"
        },
        {
          "comment": "YAML key with double-quoted value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(\"[^\"]*\")\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.quoted.double.yaml" }
          }
        },
        {
          "comment": "YAML key with single-quoted value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*('[^']*')\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.quoted.single.yaml" }
          }
        },
        {
          "comment": "YAML key with boolean value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(true|false|yes|no|on|off)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.language.boolean.yaml" }
          }
        },
        {
          "comment": "YAML key with null value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(null|~)?\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.language.null.yaml" }
          }
        },
        {
          "comment": "YAML key with numeric value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.numeric.yaml" }
          }
        },
        {
          "comment": "YAML key with unquoted string value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(.+?)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.unquoted.yaml" }
          }
        },
        {
          "comment": "YAML key only (nested object)",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" }
          }
        },
        {
          "comment": "YAML list item",
          "match": "^(\\s*)(-)\\s*(.*)$",
          "captures": {
            "2": { "name": "punctuation.definition.block.sequence.item.yaml" },
            "3": { "name": "string.unquoted.yaml" }
          }
        }
      ]
    },
    "fenced-code-block": {
      "patterns": [
        {
          "comment": "Fenced code block with ```",
          "name": "markup.fenced_code.block.markdown",
          "begin": "^(\\s*)(```)([^`\\s]*)\\s*$",
          "end": "^\\1(```)\\s*$",
          "beginCaptures": {
            "2": { "name": "punctuation.definition.code.begin.markdown" },
            "3": { "name": "fenced_code.block.language.markdown" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.code.end.markdown" }
          },
          "patterns": [
            {
              "name": "markup.raw.code.markdown",
              "match": ".+"
            }
          ]
        },
        {
          "comment": "Fenced code block with ~~~",
          "name": "markup.fenced_code.block.markdown",
          "begin": "^(\\s*)(~~~)([^~\\s]*)\\s*$",
          "end": "^\\1(~~~)\\s*$",
          "beginCaptures": {
            "2": { "name": "punctuation.definition.code.begin.markdown" },
            "3": { "name": "fenced_code.block.language.markdown" }
          },
          "endCaptures": {
            "1": { "name": "punctuation.definition.code.end.markdown" }
          },
          "patterns": [
            {
              "name": "markup.raw.code.markdown",
              "match": ".+"
            }
          ]
        }
      ]
    },
    "blockquote": {
      "comment": "Blockquote",
      "name": "markup.quote.markdown",
      "begin": "^(\\s*)(>)\\s?",
      "end": "$",
      "beginCaptures": {
        "2": { "name": "punctuation.definition.quote.begin.markdown" }
      },
      "patterns": [
        { "include": "#inline" },
        { "include": "#twig" },
        { "include": "#shortcodes" }
      ]
    },
    "horizontal-rule": {
      "comment": "Horizontal rule (---, ***, ___)",
      "name": "meta.separator.markdown",
      "match": "^\\s*([-*_])\\1\\1+\\s*$",
      "captures": {
        "0": { "name": "punctuation.definition.separator.markdown" }
      }
    },
    "heading": {
      "comment": "ATX-style headings",
      "name": "markup.heading.markdown",
      "begin": "^(#{1,6})\\s+",
      "end": "$",
      "beginCaptures": {
        "1": { "name": "punctuation.definition.heading.markdown" }
      },
      "patterns": [
        { "include": "#inline" },
        { "include": "#twig" },
        { "include": "#shortcodes" }
      ]
    },
    "list-item": {
      "patterns": [
        {
          "comment": "Unordered list item",
          "name": "markup.list.unnumbered.markdown",
          "begin": "^(\\s*)([-*+])\\s+",
          "end": "$",
          "beginCaptures": {
            "2": { "name": "punctuation.definition.list.begin.markdown" }
          },
          "patterns": [
            { "include": "#inline" },
            { "include": "#twig" },
            { "include": "#shortcodes" }
          ]
        },
        {
          "comment": "Ordered list item",
          "name": "markup.list.numbered.markdown",
          "begin": "^(\\s*)(\\d+)([.)])\\s+",
          "end": "$",
          "beginCaptures": {
            "2": { "name": "constant.numeric.list.markdown" },
            "3": { "name": "punctuation.definition.list.begin.markdown" }
          },
          "patterns": [
            { "include": "#inline" },
            { "include": "#twig" },
            { "include": "#shortcodes" }
          ]
        }
      ]
    },
    "inline": {
      "patterns": [
        { "include": "#inline-code" },
        { "include": "#link-image" },
        { "include": "#bold" },
        { "include": "#italic" },
        { "include": "#strikethrough" }
      ]
    },
    "inline-code": {
      "comment": "Inline code with backticks",
      "name": "markup.inline.raw.string.markdown",
      "match": "(`+)([^`]+)(\\1)",
      "captures": {
        "1": { "name": "punctuation.definition.raw.begin.markdown" },
        "2": { "name": "markup.raw.inline.markdown" },
        "3": { "name": "punctuation.definition.raw.end.markdown" }
      }
    },
    "link-image": {
      "patterns": [
        {
          "comment": "Image ![alt](url)",
          "name": "meta.image.markdown",
          "match": "(!)\\[([^\\]]*?)\\]\\(([^)]+)\\)",
          "captures": {
            "1": { "name": "punctuation.definition.image.markdown" },
            "2": { "name": "string.other.link.title.markdown" },
            "3": { "name": "markup.underline.link.image.markdown" }
          }
        },
        {
          "comment": "Link [text](url)",
          "name": "meta.link.markdown",
          "match": "\\[([^\\]]*?)\\]\\(([^)]+)\\)",
          "captures": {
            "1": { "name": "string.other.link.title.markdown" },
            "2": { "name": "markup.underline.link.markdown" }
          }
        },
        {
          "comment": "Reference link [text][ref]",
          "name": "meta.link.reference.markdown",
          "match": "\\[([^\\]]*?)\\]\\[([^\\]]*)\\]",
          "captures": {
            "1": { "name": "string.other.link.title.markdown" },
            "2": { "name": "constant.other.reference.link.markdown" }
          }
        },
        {
          "comment": "Link definition [ref]: url",
          "name": "meta.link.definition.markdown",
          "match": "^\\s*\\[([^\\]]+)\\]:\\s*(.+)$",
          "captures": {
            "1": { "name": "constant.other.reference.link.markdown" },
            "2": { "name": "markup.underline.link.markdown" }
          }
        },
        {
          "comment": "Auto-link <url>",
          "name": "meta.link.auto.markdown",
          "match": "<(https?://[^>]+)>",
          "captures": {
            "1": { "name": "markup.underline.link.markdown" }
          }
        },
        {
          "comment": "Auto-link email <email>",
          "name": "meta.link.email.markdown",
          "match": "<([^@>]+@[^>]+)>",
          "captures": {
            "1": { "name": "markup.underline.link.email.markdown" }
          }
        }
      ]
    },
    "bold": {
      "patterns": [
        {
          "comment": "Bold text with **",
          "name": "markup.bold.markdown",
          "match": "(\\*\\*)([^*]+)(\\*\\*)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        },
        {
          "comment": "Bold text with __",
          "name": "markup.bold.markdown",
          "match": "(__)([^_]+)(__)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        }
      ]
    },
    "italic": {
      "patterns": [
        {
          "comment": "Italic text with *",
          "name": "markup.italic.markdown",
          "match": "(?<!\\*)(\\*)([^*]+)(\\*)(?!\\*)",
          "captures": {
            "1": { "name": "punctuation.definition.italic.begin.markdown" },
            "2": { "name": "markup.italic.text.markdown" },
            "3": { "name": "punctuation.definition.italic.end.markdown" }
          }
        },
        {
          "comment": "Italic text with _",
          "name": "markup.italic.markdown",
          "match": "(?<!_)(_)([^_]+)(_)(?!_)",
          "captures": {
            "1": { "name": "punctuation.definition.italic.begin.markdown" },
            "2": { "name": "markup.italic.text.markdown" },
            "3": { "name": "punctuation.definition.italic.end.markdown" }
          }
        }
      ]
    },
    "strikethrough": {
      "comment": "Strikethrough text with ~~",
      "name": "markup.strikethrough.markdown",
      "match": "(~~)([^~]+)(~~)",
      "captures": {
        "1": { "name": "punctuation.definition.strikethrough.begin.markdown" },
        "2": { "name": "markup.strikethrough.text.markdown" },
        "3": { "name": "punctuation.definition.strikethrough.end.markdown" }
      }
    },
    "twig": {
      "patterns": [
        { "include": "#twig-comment" },
        { "include": "#twig-output" },
        { "include": "#twig-statement" }
      ]
    },
    "twig-comment": {
      "name": "comment.block.twig.grav",
      "begin": "\\{#",
      "end": "#\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.comment.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.comment.end.twig" }
      }
    },
    "twig-output": {
      "name": "meta.output.twig.grav",
      "begin": "\\{\\{-?",
      "end": "-?\\}\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.output.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.output.end.twig" }
      },
      "patterns": [
        { "include": "#twig-expression" }
      ]
    },
    "twig-statement": {
      "name": "meta.statement.twig.grav",
      "begin": "\\{%-?",
      "end": "-?%\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.statement.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.statement.end.twig" }
      },
      "patterns": [
        { "include": "#twig-keywords" },
        { "include": "#twig-expression" }
      ]
    },
    "twig-keywords": {
      "match": "\\b(if|else|elseif|endif|for|endfor|in|block|endblock|extends|include|embed|endembed|macro|endmacro|import|from|as|set|endset|with|endwith|autoescape|endautoescape|filter|endfilter|spaceless|endspaceless|verbatim|endverbatim|apply|endapply|do|flush|use|only|ignore missing|sandbox|endsandbox|trans|endtrans|transchoice|cache|endcache)\\b",
      "name": "keyword.control.twig"
    },
    "twig-expression": {
      "patterns": [
        {
          "name": "string.quoted.single.twig",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" }
          ]
        },
        {
          "name": "string.quoted.double.twig",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" },
            { "include": "#twig-interpolation" }
          ]
        },
        {
          "name": "constant.numeric.twig",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        },
        {
          "name": "constant.language.twig",
          "match": "\\b(true|false|null|none)\\b"
        },
        {
          "name": "keyword.operator.twig",
          "match": "\\b(and|or|not|in|is|as)\\b|==|!=|<|>|<=|>=|\\+|-|\\*|/|%|\\||~|\\.\\.|\\.(?!\\d)|\\?"
        },
        {
          "name": "support.function.twig",
          "match": "\\b(abs|batch|capitalize|column|convert_encoding|country_name|currency_name|currency_symbol|data_uri|date|date_modify|default|e|escape|filter|first|format|format_currency|format_date|format_datetime|format_number|format_time|html_to_markdown|inky_to_html|inline_css|join|json_encode|keys|language_name|last|length|locale_name|lower|map|markdown_to_html|merge|nl2br|number_format|raw|reduce|replace|reverse|round|slice|slug|sort|spaceless|split|striptags|timezone_name|title|trim|u|upper|url_encode)\\b"
        },
        {
          "name": "variable.other.twig",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        }
      ]
    },
    "twig-interpolation": {
      "name": "meta.interpolation.twig",
      "begin": "#\\{",
      "end": "\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.interpolation.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.interpolation.end.twig" }
      },
      "patterns": [
        { "include": "#twig-expression" }
      ]
    },
    "shortcodes": {
      "patterns": [
        { "include": "#shortcode-self-closing-simple" },
        { "include": "#shortcode-self-closing" },
        { "include": "#shortcode-close" },
        { "include": "#shortcode-open" }
      ]
    },
    "shortcode-self-closing-simple": {
      "comment": "Self-closing shortcode without attributes like [hr/]",
      "name": "meta.shortcode.self-closing.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)(/\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-self-closing": {
      "comment": "Self-closing shortcode with attributes like [icon name='star' /]",
      "name": "meta.shortcode.self-closing.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)(\\s[^\\]]*?)(\\s?/\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "meta.shortcode.attributes.grav" },
        "4": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-open": {
      "comment": "Opening shortcode tag - must NOT be followed by ]( which would make it a link",
      "name": "meta.shortcode.open.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)((?:=[^\\s\\]]+)?)((?:\\s[^\\]]*)?)(\\])(?!\\()",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "string.unquoted.bbcode.grav" },
        "4": { "name": "meta.shortcode.attributes.grav" },
        "5": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-close": {
      "comment": "Closing shortcode tag like [/section]",
      "name": "meta.shortcode.close.grav",
      "match": "(\\[/)([a-zA-Z_][a-zA-Z0-9_-]*)(\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "punctuation.definition.tag.end.grav" }
      }
    }
  }
}
