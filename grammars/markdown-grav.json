{
  "name": "Markdown (Grav)",
  "scopeName": "text.html.markdown.grav",
  "fileTypes": ["grav"],
  "patterns": [
    {
      "include": "#frontmatter"
    },
    {
      "include": "#twig"
    },
    {
      "include": "#shortcodes"
    },
    {
      "include": "#grav-bold"
    },
    {
      "include": "#markdown-with-twig"
    }
  ],
  "repository": {
    "grav-bold": {
      "patterns": [
        {
          "comment": "Bold text with ** delimiters",
          "name": "markup.bold.markdown.grav",
          "match": "(\\*\\*)([^*]+)(\\*\\*)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        },
        {
          "comment": "Bold text with __ delimiters",
          "name": "markup.bold.markdown.grav",
          "match": "(__)([^_]+)(__)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        }
      ]
    },
    "frontmatter": {
      "name": "meta.frontmatter.yaml.grav",
      "begin": "^---\\s*$",
      "end": "^---\\s*$",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.begin.grav" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.frontmatter.end.grav" }
      },
      "patterns": [
        { "include": "#yaml-content" }
      ]
    },
    "yaml-content": {
      "patterns": [
        {
          "comment": "YAML comment",
          "name": "comment.line.number-sign.yaml",
          "match": "#.*$"
        },
        {
          "comment": "YAML key with double-quoted value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(\"[^\"]*\")\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.quoted.double.yaml" }
          }
        },
        {
          "comment": "YAML key with single-quoted value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*('[^']*')\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.quoted.single.yaml" }
          }
        },
        {
          "comment": "YAML key with boolean value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(true|false|yes|no|on|off)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.language.boolean.yaml" }
          }
        },
        {
          "comment": "YAML key with null value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(null|~)?\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.language.null.yaml" }
          }
        },
        {
          "comment": "YAML key with numeric value",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(-?\\d+(\\.\\d+)?([eE][+-]?\\d+)?)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "constant.numeric.yaml" }
          }
        },
        {
          "comment": "YAML key with unquoted string value (fallback)",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*(.+?)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" },
            "4": { "name": "string.unquoted.yaml" }
          }
        },
        {
          "comment": "YAML key only (no value)",
          "match": "^(\\s*)([a-zA-Z_][a-zA-Z0-9_-]*)(:)\\s*$",
          "captures": {
            "2": { "name": "entity.name.tag.yaml" },
            "3": { "name": "punctuation.separator.key-value.yaml" }
          }
        },
        {
          "comment": "YAML list item",
          "match": "^(\\s*)(-)\\s*(.*)$",
          "captures": {
            "2": { "name": "punctuation.definition.block.sequence.item.yaml" },
            "3": { "name": "string.unquoted.yaml" }
          }
        }
      ]
    },
    "markdown-with-twig": {
      "patterns": [
        {
          "comment": "Markdown heading with possible Twig",
          "name": "markup.heading.markdown.grav",
          "begin": "^(#{1,6})\\s+",
          "end": "$",
          "beginCaptures": {
            "1": { "name": "punctuation.definition.heading.markdown" }
          },
          "patterns": [
            { "include": "#twig" },
            { "include": "#shortcodes" }
          ]
        },
        {
          "comment": "Bold text with ** delimiters - single line match",
          "name": "markup.bold.markdown.grav",
          "match": "(\\*\\*)([^*]+)(\\*\\*)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        },
        {
          "comment": "Bold text with __ delimiters - single line match",
          "name": "markup.bold.markdown.grav",
          "match": "(__)([^_]+)(__)",
          "captures": {
            "1": { "name": "punctuation.definition.bold.begin.markdown" },
            "2": { "name": "markup.bold.text.markdown" },
            "3": { "name": "punctuation.definition.bold.end.markdown" }
          }
        },
        {
          "comment": "Italic text with * delimiter",
          "name": "markup.italic.markdown.grav",
          "begin": "(?<!\\*)\\*(?!\\*)",
          "end": "\\*",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.italic.begin.markdown" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.italic.end.markdown" }
          },
          "patterns": [
            { "include": "#twig" },
            { "include": "#shortcodes" }
          ]
        },
        {
          "comment": "Italic text with _ delimiter",
          "name": "markup.italic.markdown.grav",
          "begin": "(?<!_)_(?!_)",
          "end": "_",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.italic.begin.markdown" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.italic.end.markdown" }
          },
          "patterns": [
            { "include": "#twig" },
            { "include": "#shortcodes" }
          ]
        }
      ]
    },
    "twig": {
      "patterns": [
        {
          "include": "#twig-comment"
        },
        {
          "include": "#twig-output"
        },
        {
          "include": "#twig-statement"
        }
      ]
    },
    "twig-comment": {
      "name": "comment.block.twig.grav",
      "begin": "\\{#",
      "end": "#\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.comment.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.comment.end.twig" }
      }
    },
    "twig-output": {
      "name": "meta.output.twig.grav",
      "begin": "\\{\\{-?",
      "end": "-?\\}\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.output.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.output.end.twig" }
      },
      "patterns": [
        {
          "include": "#twig-expression"
        }
      ]
    },
    "twig-statement": {
      "name": "meta.statement.twig.grav",
      "begin": "\\{%-?",
      "end": "-?%\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.statement.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.statement.end.twig" }
      },
      "patterns": [
        {
          "include": "#twig-keywords"
        },
        {
          "include": "#twig-expression"
        }
      ]
    },
    "twig-keywords": {
      "match": "\\b(if|else|elseif|endif|for|endfor|in|block|endblock|extends|include|embed|endembed|macro|endmacro|import|from|as|set|endset|with|endwith|autoescape|endautoescape|filter|endfilter|spaceless|endspaceless|verbatim|endverbatim|apply|endapply|do|flush|use|only|ignore missing|sandbox|endsandbox|trans|endtrans|transchoice|cache|endcache)\\b",
      "name": "keyword.control.twig"
    },
    "twig-expression": {
      "patterns": [
        {
          "name": "string.quoted.single.twig",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" }
          ]
        },
        {
          "name": "string.quoted.double.twig",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "match": "\\\\.", "name": "constant.character.escape.twig" },
            { "include": "#twig-interpolation" }
          ]
        },
        {
          "name": "constant.numeric.twig",
          "match": "\\b\\d+(\\.\\d+)?\\b"
        },
        {
          "name": "constant.language.twig",
          "match": "\\b(true|false|null|none)\\b"
        },
        {
          "name": "keyword.operator.twig",
          "match": "\\b(and|or|not|in|is|as)\\b|==|!=|<|>|<=|>=|\\+|-|\\*|/|%|\\||~|\\.\\.|\\.(?!\\d)|\\?"
        },
        {
          "name": "support.function.twig",
          "match": "\\b(abs|batch|capitalize|column|convert_encoding|country_name|currency_name|currency_symbol|data_uri|date|date_modify|default|e|escape|filter|first|format|format_currency|format_date|format_datetime|format_number|format_time|html_to_markdown|inky_to_html|inline_css|join|json_encode|keys|language_name|last|length|locale_name|lower|map|markdown_to_html|merge|nl2br|number_format|raw|reduce|replace|reverse|round|slice|slug|sort|spaceless|split|striptags|timezone_name|title|trim|u|upper|url_encode)\\b"
        },
        {
          "name": "variable.other.twig",
          "match": "\\b[a-zA-Z_][a-zA-Z0-9_]*\\b"
        }
      ]
    },
    "twig-interpolation": {
      "name": "meta.interpolation.twig",
      "begin": "#\\{",
      "end": "\\}",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.interpolation.begin.twig" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.definition.interpolation.end.twig" }
      },
      "patterns": [
        { "include": "#twig-expression" }
      ]
    },
    "shortcodes": {
      "patterns": [
        {
          "include": "#shortcode-self-closing-simple"
        },
        {
          "include": "#shortcode-self-closing"
        },
        {
          "include": "#shortcode-close"
        },
        {
          "include": "#shortcode-open"
        }
      ]
    },
    "shortcode-self-closing-simple": {
      "comment": "Self-closing shortcode without attributes like [hr/]",
      "name": "meta.shortcode.self-closing.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)(/\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-self-closing": {
      "comment": "Self-closing shortcode with attributes like [icon name='star' /]",
      "name": "meta.shortcode.self-closing.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)(\\s[^\\]/]*)(\\s/\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "meta.shortcode.attributes.grav" },
        "4": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-open": {
      "comment": "Opening shortcode tag like [section] or [notice type='warning']",
      "name": "meta.shortcode.open.grav",
      "match": "(\\[)([a-zA-Z_][a-zA-Z0-9_-]*)((?:=[^\\s\\]]+)?)(.*?)(\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "string.unquoted.bbcode.grav" },
        "4": { "name": "meta.shortcode.attributes.grav" },
        "5": { "name": "punctuation.definition.tag.end.grav" }
      }
    },
    "shortcode-close": {
      "comment": "Closing shortcode tag like [/section]",
      "name": "meta.shortcode.close.grav",
      "match": "(\\[/)([a-zA-Z_][a-zA-Z0-9_-]*)(\\])",
      "captures": {
        "1": { "name": "punctuation.definition.tag.begin.grav" },
        "2": { "name": "entity.name.tag.shortcode.grav" },
        "3": { "name": "punctuation.definition.tag.end.grav" }
      }
    }
  }
}
