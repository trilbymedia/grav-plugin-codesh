{% extends 'partials/base.html.twig' %}

{% set title = "Theme Editor" %}

{% block titlebar %}
    <div class="button-bar">
        <a class="button" href="{{ admin_route('/plugins/codesh') }}">
            <i class="fa fa-reply"></i> {{ "PLUGIN_ADMIN.BACK"|t }}
        </a>
    </div>
    <h1><i class="fa fa-palette"></i> CodeSh Theme Editor</h1>
{% endblock %}

{% block content %}
<div class="codesh-theme-editor">

    {# Mode Toggle: Gallery vs Editor #}
    <div class="editor-mode-tabs">
        <button class="mode-tab active" data-mode="gallery">
            <i class="fa fa-th"></i> Theme Gallery
        </button>
        <button class="mode-tab" data-mode="editor">
            <i class="fa fa-edit"></i> Theme Editor
        </button>
    </div>

    {# Gallery Mode #}
    <div class="editor-mode" id="gallery-mode">
        <div class="gallery-header">
            <div class="gallery-actions">
                <button class="button" id="create-theme-btn">
                    <i class="fa fa-plus"></i> Create New Theme
                </button>
                <label class="button" for="import-file">
                    <i class="fa fa-upload"></i> Import Theme
                </label>
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
            <div class="gallery-filter">
                <label>
                    <input type="checkbox" id="filter-dark" checked> Dark
                </label>
                <label>
                    <input type="checkbox" id="filter-light" checked> Light
                </label>
                <label>
                    <input type="checkbox" id="filter-custom"> Custom Only
                </label>
            </div>
        </div>

        <div class="themes-gallery" id="themes-gallery">
            <div class="loading">
                <i class="fa fa-spinner fa-spin"></i> Loading themes...
            </div>
        </div>
    </div>

    {# Editor Mode #}
    <div class="editor-mode hidden" id="editor-mode">
        <div class="editor-header">
            <div class="header-left">
                <button class="button" id="back-to-gallery">
                    <i class="fa fa-arrow-left"></i> Back to Gallery
                </button>
                <div class="theme-info">
                    <h2 id="editor-theme-name">New Theme</h2>
                    <span class="badge" id="editor-theme-type">dark</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="button" id="export-theme" disabled>
                    <i class="fa fa-download"></i> Export
                </button>
                <button class="button button-danger" id="delete-theme" disabled>
                    <i class="fa fa-trash"></i> Delete
                </button>
                <button class="button button-primary" id="save-theme">
                    <i class="fa fa-save"></i> Save Theme
                </button>
            </div>
        </div>

        <div class="editor-layout">
            {# Left Column: Color Editor #}
            <div class="color-editor">
                <div class="editor-section">
                    <h3>Theme Settings</h3>
                    <div class="form-field">
                        <label for="theme-name-input">Theme Name</label>
                        <input type="text" id="theme-name-input" placeholder="my-custom-theme" pattern="[a-z0-9-_]+" required>
                        <small>Lowercase letters, numbers, hyphens and underscores only</small>
                    </div>
                    <div class="form-field">
                        <label for="theme-display-name">Display Name</label>
                        <input type="text" id="theme-display-name" placeholder="My Custom Theme">
                    </div>
                    <div class="form-field">
                        <label for="theme-variant">Variant</label>
                        <select id="theme-variant">
                            <option value="dark">Dark</option>
                            <option value="light">Light</option>
                        </select>
                    </div>
                </div>

                <div class="editor-section">
                    <h3><i class="fa fa-square"></i> Base Colors</h3>
                    <div class="color-input">
                        <label for="color-background">
                            <span class="color-name">Background</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-background" name="background" value="#1F1F22" class="color-picker">
                            <input type="text" class="hex-input" value="#1F1F22" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-foreground">
                            <span class="color-name">Foreground</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-foreground" name="foreground" value="#ABB2BF" class="color-picker">
                            <input type="text" class="hex-input" value="#ABB2BF" maxlength="7">
                        </div>
                    </div>
                </div>

                <div class="editor-section">
                    <h3><i class="fa fa-code"></i> Syntax Colors</h3>
                    <div class="color-input">
                        <label for="color-comment">
                            <span class="color-swatch" style="background: #7F848E"></span>
                            <span class="color-name">Comments</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-comment" name="comment" value="#7F848E" class="color-picker">
                            <input type="text" class="hex-input" value="#7F848E" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-keyword">
                            <span class="color-swatch" style="background: #C678DD"></span>
                            <span class="color-name">Keywords</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-keyword" name="keyword" value="#C678DD" class="color-picker">
                            <input type="text" class="hex-input" value="#C678DD" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-string">
                            <span class="color-swatch" style="background: #98C379"></span>
                            <span class="color-name">Strings</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-string" name="string" value="#98C379" class="color-picker">
                            <input type="text" class="hex-input" value="#98C379" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-number">
                            <span class="color-swatch" style="background: #D19A66"></span>
                            <span class="color-name">Numbers</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-number" name="number" value="#D19A66" class="color-picker">
                            <input type="text" class="hex-input" value="#D19A66" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-function">
                            <span class="color-swatch" style="background: #61AFEF"></span>
                            <span class="color-name">Functions</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-function" name="function" value="#61AFEF" class="color-picker">
                            <input type="text" class="hex-input" value="#61AFEF" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-type">
                            <span class="color-swatch" style="background: #E5C07B"></span>
                            <span class="color-name">Types/Classes</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-type" name="type" value="#E5C07B" class="color-picker">
                            <input type="text" class="hex-input" value="#E5C07B" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-variable">
                            <span class="color-swatch" style="background: #E06C75"></span>
                            <span class="color-name">Variables</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-variable" name="variable" value="#E06C75" class="color-picker">
                            <input type="text" class="hex-input" value="#E06C75" maxlength="7">
                        </div>
                    </div>
                    <div class="color-input">
                        <label for="color-operator">
                            <span class="color-swatch" style="background: #56B6C2"></span>
                            <span class="color-name">Operators</span>
                        </label>
                        <div class="color-controls">
                            <input type="color" id="color-operator" name="operator" value="#56B6C2" class="color-picker">
                            <input type="text" class="hex-input" value="#56B6C2" maxlength="7">
                        </div>
                    </div>
                </div>

                <div class="editor-section">
                    <h3><i class="fa fa-palette"></i> Presets</h3>
                    <select id="color-preset" class="preset-selector">
                        <option value="">-- Load Preset --</option>
                        <optgroup label="Dark Themes">
                            <option value="one-dark">One Dark</option>
                            <option value="github-dark">GitHub Dark</option>
                            <option value="dracula">Dracula</option>
                            <option value="tokyo-night">Tokyo Night</option>
                            <option value="nord">Nord</option>
                        </optgroup>
                        <optgroup label="Light Themes">
                            <option value="github-light">GitHub Light</option>
                            <option value="one-light">One Light</option>
                            <option value="solarized-light">Solarized Light</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            {# Right Column: Live Preview #}
            <div class="preview-panel">
                <div class="preview-header">
                    <h3>Live Preview</h3>
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-lang="php">PHP</button>
                        <button class="preview-tab" data-lang="javascript">JavaScript</button>
                        <button class="preview-tab" data-lang="python">Python</button>
                        <button class="preview-tab" data-lang="css">CSS</button>
                        <button class="preview-tab" data-lang="html">HTML</button>
                    </div>
                </div>
                <div class="preview-container" id="preview-container">
                    <div class="preview-loading">
                        <i class="fa fa-spinner fa-spin"></i> Generating preview...
                    </div>
                </div>
            </div>
        </div>
    </div>

    {# Copy Theme Modal #}
    <div class="modal" id="copy-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Copy Theme</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-field">
                    <label for="copy-source">Source Theme</label>
                    <select id="copy-source" class="form-control">
                        <option value="">Select a theme...</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="copy-name">New Theme Name</label>
                    <input type="text" id="copy-name" class="form-control" placeholder="my-custom-theme" pattern="[a-z0-9-_]+">
                    <small>Lowercase letters, numbers, hyphens and underscores only</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="button" id="cancel-copy">Cancel</button>
                <button class="button button-primary" id="confirm-copy">Create Copy</button>
            </div>
        </div>
    </div>

    {# Delete Confirmation Modal #}
    <div class="modal" id="delete-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Theme</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete "<strong id="delete-theme-name"></strong>"?</p>
                <p class="text-danger">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button class="button" id="cancel-delete">Cancel</button>
                <button class="button button-danger" id="confirm-delete">Delete</button>
            </div>
        </div>
    </div>

</div>

<script>
    // Pass config to JavaScript
    window.CODESH_EDITOR = {
        apiBase: '{{ admin_route('/codesh-themes') }}',
        nonce: '{{ admin.getNonce() }}',
        currentTheme: '{{ uri.query('theme') }}',
        defaultColors: {
            dark: {
                background: '#1F1F22',
                foreground: '#ABB2BF',
                comment: '#7F848E',
                keyword: '#C678DD',
                string: '#98C379',
                number: '#D19A66',
                function: '#61AFEF',
                type: '#E5C07B',
                variable: '#E06C75',
                operator: '#56B6C2'
            },
            light: {
                background: '#FAFAFA',
                foreground: '#383A42',
                comment: '#A0A1A7',
                keyword: '#A626A4',
                string: '#50A14F',
                number: '#986801',
                function: '#4078F2',
                type: '#C18401',
                variable: '#E45649',
                operator: '#0184BC'
            }
        }
    };
</script>
{% endblock %}
